<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Automodel::SchemaInspector
  
    &mdash; Documentation by YARD 0.9.14
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Automodel::SchemaInspector";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Automodel.html" title="Automodel (module)">Automodel</a></span></span>
     &raquo; 
    <span class="title">SchemaInspector</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Automodel::SchemaInspector
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Automodel::SchemaInspector</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/automodel/schema_inspector.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A utility object that issues the actual database inspection commands and
returns the table, column, primary-key, and foreign-key data.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#known_adapters-class_method" title="known_adapters (class method)">.<strong>known_adapters</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_adapter-class_method" title="register_adapter (class method)">.<strong>register_adapter</strong>(adapter:, tables:, columns:, primary_key:, foreign_keys: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>“Registers” an adapter with the Automodel::SchemaInspector.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#columns-instance_method" title="#columns (instance method)">#<strong>columns</strong>(table_name)  &#x21d2; Array&lt;ActiveRecord::ConnectionAdapters::Column&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a list of columns for the given table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#foreign_keys-instance_method" title="#foreign_keys (instance method)">#<strong>foreign_keys</strong>(table_name)  &#x21d2; Array&lt;ActiveRecord::ConnectionAdapters::ForeignKeyDefinition&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a list of foreign keys for the given table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(connection_handler)  &#x21d2; SchemaInspector </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of SchemaInspector.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#known_adapters-instance_method" title="#known_adapters (instance method)">#<strong>known_adapters</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#primary_key-instance_method" title="#primary_key (instance method)">#<strong>primary_key</strong>(table_name)  &#x21d2; String<sup>+</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the primary key for the given table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tables-instance_method" title="#tables (instance method)">#<strong>tables</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a list of table names in the target database.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(connection_handler)  &#x21d2; <tt><span class='object_link'><a href="" title="Automodel::SchemaInspector (class)">SchemaInspector</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of SchemaInspector</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>connection_handler</span>
      
      
        <span class='type'>(<tt>ActiveRecord::ConnectionHandling</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The connection pool/handler (an object that implements
ActiveRecord::ConnectionHandling) to inspect and map out.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_connection_handler'>connection_handler</span><span class='rparen'>)</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_connection_handler'>connection_handler</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span>
  <span class='id identifier rubyid_adapter'>adapter</span> <span class='op'>=</span> <span class='id identifier rubyid_connection_handler'>connection_handler</span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'>connection_pool</span><span class='period'>.</span><span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='lbracket'>[</span><span class='symbol'>:adapter</span><span class='rbracket'>]</span>

  <span class='ivar'>@registration</span> <span class='op'>=</span> <span class='id identifier rubyid_known_adapters'>known_adapters</span><span class='lbracket'>[</span><span class='id identifier rubyid_adapter'>adapter</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="known_adapters-class_method">
  
    .<strong>known_adapters</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 18</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_known_adapters'>known_adapters</span><span class='semicolon'>;</span> <span class='ivar'>@known_adapters</span><span class='semicolon'>;</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_adapter-class_method">
  
    .<strong>register_adapter</strong>(adapter:, tables:, columns:, primary_key:, foreign_keys: nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>“Registers” an adapter with the Automodel::SchemaInspector. This allows for
alternate mechanisms of procuring lists of tables, columns, primary keys,
and/or foreign keys from an adapter that may not itself support
<code>#tables</code>/<code>#columns</code>/<code>#primary_key</code>/<code>#foreign_keys</code>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>adapter</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The “adapter” value used to match that given in the connection spec. It is
with this value that the adapter being registered is matched to an existing
database pool/connection.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>tables</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Proc to <code>#call</code> to request a list of table names. The Proc
will be called with one parameter: a database connection.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>columns</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Proc to <code>#call</code> to request a list of columns for a specific
table. The Proc will be called with two parameters: a database connection
and a table name.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>primary_key</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Proc to <code>#call</code> to request the primary key for a specific
table. The Proc will be called with two parameters: a database connection
and a table name.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>foreign_keys</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Proc to <code>#call</code> to request a list of foreign keys for a
specific table. The Proc will be called with two parameters: a database
connection and a table name.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="AdapterAlreadyRegisteredError.html" title="Automodel::AdapterAlreadyRegisteredError (class)">Automodel::AdapterAlreadyRegisteredError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 50</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_register_adapter'>register_adapter</span><span class='lparen'>(</span><span class='label'>adapter:</span><span class='comma'>,</span> <span class='label'>tables:</span><span class='comma'>,</span> <span class='label'>columns:</span><span class='comma'>,</span> <span class='label'>primary_key:</span><span class='comma'>,</span> <span class='label'>foreign_keys:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_adapter'>adapter</span> <span class='op'>=</span> <span class='id identifier rubyid_adapter'>adapter</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../Automodel.html" title="Automodel (module)">Automodel</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="AdapterAlreadyRegisteredError.html" title="Automodel::AdapterAlreadyRegisteredError (class)">AdapterAlreadyRegisteredError</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_adapter'>adapter</span> <span class='kw'>if</span> <span class='id identifier rubyid_known_adapters'>known_adapters</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_adapter'>adapter</span>

  <span class='id identifier rubyid_known_adapters'>known_adapters</span><span class='lbracket'>[</span><span class='id identifier rubyid_adapter'>adapter</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>tables:</span> <span class='id identifier rubyid_tables'>tables</span><span class='comma'>,</span>
                              <span class='label'>columns:</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span>
                              <span class='label'>primary_key:</span> <span class='id identifier rubyid_primary_key'>primary_key</span><span class='comma'>,</span>
                              <span class='label'>foreign_keys:</span> <span class='id identifier rubyid_foreign_keys'>foreign_keys</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="columns-instance_method">
  
    #<strong>columns</strong>(table_name)  &#x21d2; <tt>Array&lt;ActiveRecord::ConnectionAdapters::Column&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a list of columns for the given table.</p>

<p>If a matching Automodel::SchemaInspector registration is found for the
connection&#39;s adapter, and that registration specified a
<code>:columns</code> Proc, the Proc is called. Otherwise, the standard
connection <code>#columns</code> is returned.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The table whose columns should be fetched.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;ActiveRecord::ConnectionAdapters::Column&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_columns'>columns</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='ivar'>@columns</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@columns</span><span class='lbracket'>[</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:columns</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
                             <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:columns</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='ivar'>@connection</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
                           <span class='kw'>else</span>
                             <span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_columns'>columns</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
                           <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="foreign_keys-instance_method">
  
    #<strong>foreign_keys</strong>(table_name)  &#x21d2; <tt>Array&lt;ActiveRecord::ConnectionAdapters::ForeignKeyDefinition&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a list of foreign keys for the given table.</p>

<p>If a matching Automodel::SchemaInspector registration is found for the
connection&#39;s adapter, and that registration specified a
<code>:foreign_keys</code> Proc, the Proc is called. Otherwise, the
standard connection <code>#foreign_keys</code> is attempted. If that call
to `<code>#foreign_keys</code> raises a ::NoMethodError or
::NotImplementedError, a best-effort attempt is made to build a list of
foreign keys based on table and column names.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The table whose foreign keys should be fetched.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;ActiveRecord::ConnectionAdapters::ForeignKeyDefinition&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 151</span>

<span class='kw'>def</span> <span class='id identifier rubyid_foreign_keys'>foreign_keys</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='ivar'>@foreign_keys</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@foreign_keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:foreign_keys</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:foreign_keys</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='ivar'>@connection</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='kw'>begin</span>
        <span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_foreign_keys'>foreign_keys</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>NoMethodError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>NotImplementedError</span>
        <span class='comment'>## Not all ActiveRecord adapters support `#foreign_keys`. When this happens, we&#39;ll make
</span>        <span class='comment'>## a best-effort attempt to intuit relationships from the table and column names.
</span>        <span class='comment'>##
</span>        <span class='id identifier rubyid_columns'>columns</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span>
          <span class='id identifier rubyid_id_pattern'>id_pattern</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>(?:_id|Id)$</span><span class='regexp_end'>}</span></span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_column'>column</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=~</span> <span class='id identifier rubyid_id_pattern'>id_pattern</span>

          <span class='id identifier rubyid_target_table'>target_table</span> <span class='op'>=</span> <span class='id identifier rubyid_column'>column</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='id identifier rubyid_id_pattern'>id_pattern</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_target_table'>target_table</span><span class='period'>.</span><span class='id identifier rubyid_in?'>in?</span> <span class='id identifier rubyid_tables'>tables</span>

          <span class='id identifier rubyid_target_column'>target_column</span> <span class='op'>=</span> <span class='id identifier rubyid_primary_key'>primary_key</span><span class='lparen'>(</span><span class='id identifier rubyid_qualified_name'>qualified_name</span><span class='lparen'>(</span><span class='id identifier rubyid_target_table'>target_table</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_target_column'>target_column</span><span class='period'>.</span><span class='id identifier rubyid_in?'>in?</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Id</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>

          <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>ConnectionAdapters</span><span class='op'>::</span><span class='const'>ForeignKeyDefinition</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
            <span class='id identifier rubyid_table_name'>table_name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='comma'>,</span>
            <span class='id identifier rubyid_target_table'>target_table</span><span class='comma'>,</span>
            <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FK_</span><span class='embexpr_beg'>#{</span><span class='const'>SecureRandom</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='label'>column:</span>  <span class='id identifier rubyid_column'>column</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
            <span class='label'>primary_key:</span> <span class='id identifier rubyid_target_column'>target_column</span><span class='comma'>,</span>
            <span class='label'>on_update:</span> <span class='kw'>nil</span><span class='comma'>,</span>
            <span class='label'>on_delete:</span> <span class='kw'>nil</span>
          <span class='rparen'>)</span>
        <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="known_adapters-instance_method">
  
    #<strong>known_adapters</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_known_adapters'>known_adapters</span><span class='semicolon'>;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_known_adapters'>known_adapters</span><span class='semicolon'>;</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="primary_key-instance_method">
  
    #<strong>primary_key</strong>(table_name)  &#x21d2; <tt>String</tt><sup>+</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the primary key for the given table.</p>

<p>If a matching Automodel::SchemaInspector registration is found for the
connection&#39;s adapter, and that registration specified a
<code>:primary_key</code> Proc, the Proc is called. Otherwise, the standard
connection <code>#primary_key</code> is returned.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The table whose primary key should be fetched.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_primary_key'>primary_key</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='ivar'>@primary_keys</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@primary_keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:primary_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
                                  <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:primary_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='ivar'>@connection</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
                                <span class='kw'>else</span>
                                  <span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='lparen'>(</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
                                <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tables-instance_method">
  
    #<strong>tables</strong>  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a list of table names in the target database.</p>

<p>If a matching Automodel::SchemaInspector registration is found for the
connection&#39;s adapter, and that registration specified a
<code>:tables</code> Proc, the Proc is called. Otherwise, the standard
connection <code>#tables</code> is returned.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/automodel/schema_inspector.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tables'>tables</span>
  <span class='ivar'>@tables</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:tables</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
                <span class='ivar'>@registration</span><span class='lbracket'>[</span><span class='symbol'>:tables</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='ivar'>@connection</span><span class='rparen'>)</span>
              <span class='kw'>else</span>
                <span class='ivar'>@connection</span><span class='period'>.</span><span class='id identifier rubyid_tables'>tables</span>
              <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Jun 20 18:16:11 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.14 (ruby-2.4.4).
</div>

    </div>
  </body>
</html>